webpackJsonp([44],{3170:function(e,i){!function(){"use strict";TS.registerModule("client.highlights",{updated_sig:new signals.Signal,feedback_submitted_sig:new signals.Signal,last_request_id:null,sli_recaps_debug_group:null,onStart:function(){TS.client&&TS.boot_data.feature_sli_recaps&&(TS.client.login_sig.addOnce(function(){t=_.get(TS.shared.getActiveModelOb(),"id")}),TS.channels.pre_switched_sig.add(g),TS.client.unread.marked_group_as_read_sig.add(d),TS.experiment.loadUserAssignments().then(s))},msgIsHighlight:function(i,t){return!!(e[i]&&e[i][t]&&e[i][t].show_recap)},msgIsHighlightUnfurl:function(i,t){return!!(e[i]&&e[i][t]&&e[i][t].is_unfurl)},msgIsLeavingFeedback:function(i,t){return!!(e[i]&&e[i][t]&&e[i][t].is_leaving_feedback)},canShowRecapDebug:function(i,t){return"sli_debug_info"===TS.client.highlights.sli_recaps_debug_group&&e[i]&&e[i][t]},shouldRenderHighlightsUI:function(e,i){return TS.boot_data.feature_sli_recaps_interface&&(TS.client.highlights.msgIsHighlight(e,i)||TS.client.highlights.msgIsLeavingFeedback(e,i))},isMsgBeingRequested:function(e,t){return i[e]&&i[e][t]},getHighlight:function(i,t){return e[i]&&e[i][t]},getHighlightsForChannel:function(i){return e[i]},addHighlights:function(i){var t={};e=_.reduce(i,function(e,i,n){return e[n]=e[n]||{},_.each(i,function(i,s){e[n][s]&&(e[n][s].show_recap||e[n][s].is_leaving_feedback||e[n][s].left_feedback)?(e[n][s].request_id=i.request_id,e[n][s].cached_request_id=i.cached_request_id):(e[n][s]=i,e[n][s].justification=TS.format.formatWithOptions(i.justification||"",void 0,{no_linking:!0}),t[n]=t[n]||{},t[n][s]=e[n][s])}),e},e),_.isEmpty(t)||TS.client.highlights.updated_sig.dispatch(t)},setDefaultFeedbackForHighlight:function(i,t,s,a){if(e[i]&&e[i][t]){e[i][t]=_.assign({},e[i][t],s),"negative"===s.feedback&&(e[i][t].show_recap=!1,e[i][t].is_leaving_feedback=!0);var c={};c[i]={},c[i][t]=e[i][t],TS.client.highlights.feedback_submitted_sig.dispatch(c);var g;g="dismiss"===s.feedback?"dismiss":"default_"+s.feedback,n(e[i][t],_.get(e[i][t],["feedback_options",g,"args"]),a)}},setNegativeFeedbackForHighlight:function(i,t,s,a){if(e[i]&&e[i][t]){e[i][t].is_leaving_feedback=!1,e[i][t].left_feedback=!0;var c={};c[i]={},c[i][t]=e[i][t],TS.client.highlights.feedback_submitted_sig.dispatch(c),n(e[i][t],_.get(e[i][t],["feedback_options","negative",s,"args"]),a)}},getHighlightsForMessages:function(e){if(e.timestamps.length){var i=_.map(e.timestamps,function(e){return{ts:e,is_unread:!0}});return a(e.channel.id,e.timestamps),TS.api.call("highlights.list",{channel:e.channel.id,messages:JSON.stringify(i),channel_open_ts:e.channel_open_ts||TS.utility.date.makeTsStamp(e.channel.last_made_active,"0"),channel_open_last_read_ts:e.channel.last_read}).then(function(e){TS.client.highlights.last_request_id=e.request_id,TS.client.highlights.addHighlights(e.data.messages)}).catch(function(e){TS.error(e)}).finally(function(){c(e.channel.id,e.timestamps)})}},test:function(){var i={};return Object.defineProperty(i,"_cache",{get:function(){return e},set:function(i){e=i}}),i}});var e={},i={},t=null,n=function(e,i,t){if(i){var n=_.assign({},i,{request_id:e.request_id||TS.client.highlights.last_request_id,source:t});e.cached_request_id&&(n.cached_request_id=e.cached_request_id),TS.api.call("highlights.feedback",n).catch(function(e){TS.error(e)})}},s=function(){TS.client.highlights.sli_recaps_debug_group=TS.experiment.getGroup("sli_recaps_debug")},a=function(e,t){i[e]=i[e]||{},_.each(t,function(t){i[e][t]=!0})},c=function(e,t){_.each(t,function(t){i[e]&&i[e][t]&&delete i[e][t]}),!_.isUndefined(i[e])&&_.isEmpty(i[e])&&delete i[e]},g=function(){var e=TS.shared.getModelObById(t);e&&r(e),t=_.get(TS.shared.getActiveModelOb(),"id")},d=function(e){r(e.model_ob)},r=function(i){if(e[i.id]){var t=parseFloat(i.last_read);_.each(e[i.id],function(e,n){parseFloat(n)<=t&&l(i.id,n)}),_.isEmpty(e[i.id])&&delete e[i.id]}},l=function(i,t){e[i]&&e[i][t]&&delete e[i][t]}}()}},[3170]);