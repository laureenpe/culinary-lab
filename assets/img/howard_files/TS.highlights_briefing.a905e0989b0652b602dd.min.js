webpackJsonp([252],{2747:function(e,i){!function(){"use strict";TS.registerModule("highlights_briefing",{sli_recaps_debug_group:null,sli_highlights_launch_group:null,sli_briefings_dark_test_group:null,updated_sig:new signals.Signal,$briefing_header:null,$briefing_view:null,onStart:function(){TS.client&&(TS.client.ui.unread.started_sig.add(h),TS.client.unread.switched_away_sig.add(k),TS.channels.switched_sig.add(F),TS.groups.switched_sig.add(F),TS.mpims.switched_sig.add(F),TS.ims.switched_sig.add(F),TS.client.threads.switched_sig.add(H),TS.channels.marked_sig.add(z),TS.groups.marked_sig.add(z),TS.channels.message_changed_sig.add(X),TS.groups.message_changed_sig.add(X),TS.channels.message_removed_sig.add(Z),TS.groups.message_removed_sig.add(Z),TS.pins.pinned_status_changed_sig.add(Q),TS.boot_data.feature_sli_highlights_cache&&TS.client.highlights.feedback_submitted_sig.add(N),TS.experiment.loadUserAssignments().then(function(){TS.highlights_briefing.sli_recaps_debug_group=TS.experiment.getGroup("sli_recaps_debug"),TS.highlights_briefing.sli_highlights_launch_group=TS.experiment.getGroup("sli_highlights_launch"),TS.highlights_briefing.sli_briefings_dark_test_group=TS.experiment.getGroup("sli_briefings_dark_test"),(TS.highlights_briefing.isEnabled()||"sli_briefings_dark_test"===TS.highlights_briefing.sli_briefings_dark_test_group)&&d&&h()}))},getDebugInfoFor:function(e,i){return _.get(a[i][e],"score")},getMessageFromCache:function(e,i){return _.get(a,[e,i],null)},getFeedbackFromCache:function(e,i){return _.get(n,[e,i],null)},setFeedbackInCache:function(e,i,s){x(e,i,s)},isEnabled:function(){return null!==TS.highlights_briefing.sli_highlights_launch_group&&"sli_highlights_launch"===TS.highlights_briefing.sli_highlights_launch_group.substring(0,"sli_highlights_launch".length)},showBriefing:function(){e.removeClass("hidden"),t.toggleClass("hidden",!r.expanded)},hideBriefing:function(){e.addClass("hidden"),t.addClass("hidden")},sendFeedback:function(e,i,s,t,n){if(TS.highlights_briefing.getMessageFromCache(t,s)){if("dismiss"!==I(s,t)){var r=$('.sli_briefing__message[data-cache-id="'+t+"-"+s+'"]'),d=_.get(a,[t,s]);if("dismiss"===i){V(r,i,s,t);var l=_.assign({},d.feedback_options.dismiss.args,{request_id:d.request_id});d.cached_request_id&&(l.cached_request_id=d.cached_request_id),TS.api.call("highlights.feedback",l)}else if("negative"===i){if(r.find("ts-message").addClass("hidden"),r.addClass("gave_negative_feedback"),r.find('[data-highlight-feedback="negative"]').addClass("sli_briefing__feedback_control--pulse"),$('[data-feedback-for-cache-id="'+t+"-"+s+'"]').removeClass("hidden"),x("negative",s,t),n){var g=_.assign({},d.feedback_options.default_negative.args,{request_id:d.request_id});d.cached_request_id&&(g.cached_request_id=d.cached_request_id),TS.api.call("highlights.feedback",g)}}else if("positive"===i&&(r.addClass("gave_positive_feedback"),r.find('[data-highlight-feedback="positive"]').addClass("sli_briefing__feedback_control--pulse"),x("positive",s,t),n)){var h=_.assign({},d.feedback_options.default_positive.args,{request_id:d.request_id});d.cached_request_id&&(h.cached_request_id=d.cached_request_id),TS.api.call("highlights.feedback",h)}}}},handleSecondaryFeedbackMenuClick:function(e,i,s,t){var n=_.get(a,[i,s]);if(n){var r=_.get(n,["feedback_options","negative",e,"args"]);if(n&&r){t||(_.assign(r,{request_id:n.request_id}),n.cached_request_id&&(r.cached_request_id=n.cached_request_id),TS.api.call("highlights.feedback",r));var d=$('.sli_briefing__message[data-cache-id="'+i+"-"+s+'"]');V(d,"dismiss",s,i)}}},clogBackButton:function(){var e,i=_.get(r,["last_jump","model_ob_id"]),s=_.get(r,["last_jump","ts"]),t={channel_id:i,channel_type:i[0]||"",message_timestamp:s};if(TS.boot_data.feature_sli_highlights_cache){var n=TS.client.highlights.getHighlight(i,s);n&&(t.request_id=n.request_id,e=n.cached_request_id)}else{var d=_.get(a,[i,s]);d&&(t.request_id=d.request_id,e=d.cached_request_id)}e&&(t.cached_request_id=e),TS.clog.track("BRIEFING_BACK_TO_BRIEFING",t)},jumpToMessageInChannel:function(e,i){W(e,i)},setUnreadPointOnMessage:function(e){e=String(e);var i=$('.sli_briefing__message ts-message[data-ts="'+e+'"]');if(i.length){var s=i.data("model-ob-id");TS.shared.markReadMsg(s,e,TS.model.marked_reasons.back),TS.client.markLastReadsWithAPI(),z(TS.shared.getModelObById(s))}}});var e=null,i=null,s=null,t=null,a={},n={},r={expanded:!1,scroll_top:0,last_jump:{ts:null,model_ob_id:null},show_briefing_back_button:!1,last_open_ts:null,loading:!0},d=!1,l=null,g={},h=function(){return null===TS.highlights_briefing.sli_highlights_launch_group&&null===TS.highlights_briefing.sli_briefings_dark_test_group?void(d=!0):TS.highlights_briefing.isEnabled()?((r.show_briefing_back_button||_.get(r,["last_jump","model_ob_id"]))&&B(),r.briefing_opens_count=TS.storage.fetchBriefingOpensCount(),r.loading=!0,f(),TS.api.call("highlights.briefing").then(TS.boot_data.feature_sli_highlights_cache?o:c).then(u).catch(function(e){TS.error("A call to highlights.briefing failed:"),TS.logError(e,"Highlights in All Unreads either failed to render or got an error from the API"),v(null,0,!1,!0)}),void A()):void("sli_briefings_dark_test"===TS.highlights_briefing.sli_briefings_dark_test_group&&TS.api.call("highlights.briefing"))},c=function(e){return _.get(e,"data.messages.length")&&(e.data.messages=_.map(e.data.messages,function(e){var i=TS.utility.msgs.processImsg(e,e.channel_id);return i.channel=e.channel,i.channel_id=e.channel_id,i.justification=TS.format.formatWithOptions(e.justification||"",e,{no_linking:!0}),i.score=e.score,i.feedback_options=e.feedback_options,i.request_id=e.request_id,i.cached_request_id=e.cached_request_id,i.is_briefing_message=!0,i})),e},o=function(e){var i={};return _.get(e,"data.messages.length")&&(e.data.messages=_.map(e.data.messages,function(e){var s=e.channel_id,t=TS.utility.msgs.processImsg(e,s);t.channel_id=s;var a={};return a.show_recap=!0,a.score=e.score,a.feedback_options=e.feedback_options,a.request_id=e.request_id,a.cached_request_id=e.cached_request_id,a.justification=e.justification,i[s]=i[s]||{},i[s][e.ts]=a,t}),TS.client.highlights.addHighlights(i)),e},f=function(){$("#unread_msgs_div").before(TS.templates.sli_briefing({show_onboarding:r.briefing_opens_count<3})),$("#unread_msgs_scroller_div").prepend(TS.templates.sli_briefing_header())},u=function(e){if(l=e.request_id,r.loading=!1,null!==r.last_open_ts&&r.last_open_ts<Date.now()-9e5&&(r.expanded=!1),_.get(e,"data.messages.length")){var n=_.groupBy(e.data.messages,"channel_id"),d=_(n).map(function(e,i){var s=TS.shared.getModelObById(i),t=TS.shared.getTypeForModelOb(s),a=TS.templates.builders.buildStarWithTip(t,s),n={channel:s,star:new Handlebars.SafeString(a),messages:_(e).map(TS.boot_data.feature_sli_highlights_cache?m:p).compact().value()};return n.messages.length?n:null}).compact().value();d.length&&(T(e.data.messages),i.find(".sli_briefing_view__messages").html(TS.templates.sli_briefing_message_view({groups:d})))}else a={};e.data.headline?(g={header:TS.format.formatWithOptions(e.data.headline.header||"","",{no_linking:!0}),subheader:TS.format.formatWithOptions(e.data.headline.subheader||"","",{no_linking:!0})},S(e.data.headline.users)):g={header:"",subheader:""};var h=w();if(r.expanded&&h)G(!1);else if(r.expanded&&!h)r.expanded=!1,s.removeClass("hidden"),i.addClass("hidden"),t.addClass("hidden"),v(null,0,!0);else{var c=j();v(c,w())}var o=_.get(r,["last_jump","model_ob_id"]),f=_.get(r,["last_jump","ts"]);_.get(a,[o,f])&&(r.scroll_top=0,r.last_jump.ts=null,r.last_jump.model_ob_id=null),h&&(r.briefing_opens_count+=1,TS.storage.storeBriefingOpensCount(r.briefing_opens_count)),TS.highlights_briefing.updated_sig.dispatch()},b=function(e){var i;i=TS.boot_data.feature_sli_highlights_cache?TS.shared.getModelObById(e.channel_id):e.channel;var s=$(TS.templates.builders.msgs.buildHTML({msg:e,model_ob:i,enable_slack_action_links:!0,container_id:"sli_briefing",prev_msg:null,briefing:!0}));return(e.pinned_to&&e.pinned_to.length||_.get(e,"file.pinned_to.length"))&&s.removeClass("is_pinned"),s.addClass("is_sli_briefing"),s[0].outerHTML},p=function(e){var i=I(e.ts,e.channel.id),s=E(i);if(i&&"jump"!==i&&"positive"!==i)return null;var t=_.map(e.feedback_options.negative,function(e){return _.assign({},e,{text:new Handlebars.SafeString(TS.format.formatWithOptions(e.text,null,{no_linking:!0}))})});return{message_markup:b(e),message:e,justification:e.justification?new Handlebars.SafeString(e.justification):null,feedback_class:s,negative_feedback_options:t}},m=function(e){var i=TS.client.highlights.getHighlight(e.channel_id,e.ts);if(i.feedback&&"positive"!==i.feedback)return null;var s=E(i.feedback),t=_.map(i.feedback_options.negative,function(e){return _.assign({},e,{text:new Handlebars.SafeString(TS.format.formatWithOptions(e.text,null,{no_linking:!0}))})});return{message_markup:b(e),message:e,justification:i.justification,feedback_class:s,negative_feedback_options:t}},v=function(e,i,t,a){e&&i?(s.removeClass("sli_briefing_preview--loading").addClass("sli_briefing_preview--has_briefings"),s.find('[data-js="sli_briefing_preview_title"]').html(e.header),r.briefing_opens_count>=3&&s.find('[data-js="sli_briefing_preview_description"]').html(e.subheader),s.find('[data-js="sli_briefing_preview_action"]').removeClass("hidden"),r.briefing_opens_count>=3&&s.find('[data-js="sli_briefing_preview_facepile"]').removeClass("hidden")):t?(s.removeClass("sli_briefing_preview--loading sli_briefing_preview--has_briefings").addClass("sli_briefing_preview--empty"),s.find('[data-js="sli_briefing_preview_title"]').text(TS.i18n.t("Done and done","highlights")()),s.find('[data-js="sli_briefing_preview_description"]').text(TS.i18n.t("That’s it for the highlights! The rest of your unreads are below.","highlights")()),s.find('[data-js="sli_briefing_preview_action"]').addClass("hidden"),s.find('[data-js="sli_briefing_preview_facepile"]').addClass("hidden")):a?(s.removeClass("sli_briefing_preview--loading sli_briefing_preview--has_briefings").addClass("sli_briefing_preview--empty"),s.find('[data-js="sli_briefing_preview_title"]').removeClass("small_bottom_margin").addClass("error no_bottom_margin").text(TS.i18n.t("Couldn’t load highlights","highlights")()),s.find('[data-js="sli_briefing_preview_description"]').addClass("hidden"),s.find('[data-js="sli_briefing_preview_action"]').addClass("hidden")):(s.removeClass("sli_briefing_preview--loading sli_briefing_preview--has_briefings").addClass("sli_briefing_preview--empty"),s.find('[data-js="sli_briefing_preview_title"]').text(TS.i18n.t("No new highlights","highlights")()),s.find('[data-js="sli_briefing_preview_description"]').text(TS.i18n.t("But we’ll keep an ear to the ground.","highlights")()),s.find('[data-js="sli_briefing_preview_action"]').addClass("hidden")),TS.highlights_briefing.updated_sig.dispatch()},S=function(e){var i=_.map(e,function(e){var i=TS.members.getMemberById(e);return TS.templates.builders.makeMemberPreviewLinkImage(i,32,!1,!0,!0,!0)}).join("");s.find('[data-js="sli_briefing_preview_facepile"]').html(i)},T=function(e){a={},_.forEach(e,function(e){a[e.channel_id]=a[e.channel_id]||{},a[e.channel_id][e.ts]=e,TS.boot_data.feature_sli_highlight_unreads&&TS.client.ui.sli_highlight_all_unreads&&TS.client.ui.sli_highlight_all_unreads.setRecapCache(e.channel_id,e.ts,_.assign({},e.score,{justification:e.justification,request_id:e.request_id,cached_request_id:e.cached_request_id,feedback_options:e.feedback_options,from_briefing:!0}))})},k=function(){TS.highlights_briefing.isEnabled()&&(P(),e=null,i=null,s=null,t=null,TS.highlights_briefing.$briefing_header=null,TS.highlights_briefing.$briefing_view=null,l=null,g=null,r.last_open_ts=Date.now(),TS.boot_data.feature_sli_highlights_cache||_.each(n,function(e){_.each(e,function(i,s){"negative"===i&&(e[s]="dismiss")})}))},w=function(){return _.reduce(a,function(e,i,s){return e+C(s)},0)},C=function(e){return _.reduce(a[e],function(e,i){return y(i)?e+1:e},0)},q=function(){return _(a).flatMap(function(e){return _.map(e,function(e){return y(e)?e:null})}).compact().value()},y=function(e){var i=TS.client.highlights.getHighlight(e.channel_id,e.ts)||{};return!(e._removed||"dismiss"===i.feedback||i.left_feedback)},j=function(){return g},x=function(e,i,s){TS.boot_data.feature_sli_highlights_cache||(n[s]||(n[s]={}),n[s][i]=e)},I=function(e,i){return TS.boot_data.feature_sli_highlights_cache?_.get(TS.client.highlights.getHighlight(i,e),"feedback"):_.get(n,[i,e])},E=function(e){return"negative"===e?"gave_negative_feedback":"positive"===e?"gave_positive_feedback":"dismiss"===e?"sli_briefing__feedback--dismiss":""},F=function(){TS.highlights_briefing.isEnabled()&&(TS.model.active_cid===_.get(r,["last_jump","model_ob_id"])&&r.show_briefing_back_button?M():r.last_jump&&r.show_briefing_back_button&&B())},H=function(){TS.highlights_briefing.isEnabled()&&r.last_jump&&r.show_briefing_back_button&&B()},M=function(){$(".sli_briefing__channel_back_button").removeClass("hidden"),$("#messages_unread_status").addClass("sli_briefing--has_back_button")},B=function(){$(".sli_briefing__channel_back_button").addClass("hidden"),$("#messages_unread_status").removeClass("sli_briefing--has_back_button"),r.show_briefing_back_button=!1},O=function(e,i,s){if("dismiss"===e){var t,n={request_id:l,message_timestamp:i,channel_id:s,channel_type:s[0]||""};if(TS.boot_data.feature_sli_highlights_cache){t=TS.client.highlights.getHighlight(s,i).cached_request_id}else t=_.get(a,[s,i,"cached_request_id"]);t&&(n.cached_request_id=t),TS.clog.track("MSG_BRIEFING_DISMISS",n)}},A=function(){e=$("#sli_briefing"),i=$("[data-js=sli_briefing_view]"),s=$('[data-js="sli_briefing_preview_container"]'),t=$('[data-js="sli_briefing_header"]'),TS.highlights_briefing.$briefing_header=t,TS.highlights_briefing.$briefing_view=i,e.on("click",".sli_briefing__message ts-message, .sli_briefing_target",function(e){if(!(!$(e.target).is("ts-message, .message_content, .message_body, .message_content_header_left, .sli_briefing_target, .comment, .rxn_panel")&&!$(e.target).parents(".message_body").length||$(e.target).parents(".msg_inline_file_preview_toggler").length||$(e.target).is("a")&&$(e.target).closest(".message_body").length||$(e.target).closest(".attachment_media").length)){var i=$(this).is("ts-message")?$(this):$(this).parents("ts-message"),s=i.data("ts")+"",t=i.data("model-ob-id")+"";W(t,s)}}),e.on("click",".sli_briefing__channel_link .channel_link",function(e){var i=$(e.target).data("channel-id");"G"===i[0]&&TS.groups.displayGroup({id:i})}),e.on("click",'[data-js="sli_briefing_preview"]',function(){if(!r.loading){r.expanded=!0,G(!0);var e,i={request_id:l},s=_.keys(a)[0],t=_.keys(_.get(a,[s]))[0];if(TS.boot_data.feature_sli_highlights_cache){e=TS.client.highlights.getHighlight(s,t).cached_request_id}else e=_.get(a,[s,t,"cached_request_id"]);e&&(i.cached_request_id=e),TS.clog.track("BRIEFING_REVEAL",i),TS.highlights_briefing.updated_sig.dispatch()}}),t.off("click").on("click",'[data-js="sli_briefing_header_dismiss_all"]',function(){r.expanded=!1,R();var e=q(),i=_.map(e,function(e){return{channel_id:e.channel_id,ts:e.ts}});TS.api.call("highlights.dismissAll",{request_id:l,source:"briefing",messages:JSON.stringify(i)}).catch(function(e){TS.error(e)})}),e.on("click",'[data-js="sli_briefing_feedback_item"] a',function(e){e.preventDefault();var i=($(e.target).closest(".sli_briefing__feedback_leavebehind").data("feedback-for-cache-id")||"").split("-"),s=Number($(e.target).closest("li").data("index")),t=i[0],a=i[1];TS.boot_data.feature_sli_highlights_cache?TS.client.highlights.setNegativeFeedbackForHighlight(t,a,s,"briefing"):TS.highlights_briefing.handleSecondaryFeedbackMenuClick(s,t,a)}),e.on("click","[data-feedback]",function(e){e.preventDefault();var i=$(e.target).data("feedback"),s=$(e.target).closest(".sli_briefing__message"),t=(s.data("cache-id")||"").split("-"),a=t[0],n=t[1];TS.boot_data.feature_sli_highlights_cache?TS.client.highlights.setDefaultFeedbackForHighlight(a,n,{feedback:i},"briefing"):(TS.highlights_briefing.sendFeedback(e,i,n,a),TS.boot_data.feature_sli_highlight_unreads&&TS.client.ui.sli_highlight_all_unreads&&TS.client.ui.sli_highlight_all_unreads.sendFeedback(e,i,n,a)),$("#ts_tip_float_floater .ts_tip_tip").text(TS.i18n.t("Thank you!","highlights")())})},N=function(e){TS.model.unread_view_is_showing&&_.each(e,function(e,i){_.each(e,function(e,s){if(a[i]&&a[i][s]){var t=$('[data-cache-id="'+i+"-"+s+'"]');t.length&&D(t,i,s,e)}})})},D=function(e,i,s,t){"dismiss"===t.feedback||!t.is_leaving_feedback&&t.left_feedback?(L(e,i,function(){Y()&&K()}),O("dismiss",s,i)):"negative"===t.feedback&&t.is_leaving_feedback?(e.find("ts-message").addClass("hidden"),e.addClass("gave_negative_feedback"),e.find('[data-feedback="negative"]').addClass("sli_briefing__feedback_control--pulse"),$('[data-feedback-for-cache-id="'+i+"-"+s+'"]').removeClass("hidden")):"positive"===t.feedback&&(e.addClass("gave_positive_feedback"),e.find('[data-feedback="positive"]').addClass("sli_briefing__feedback_control--pulse"))},G=function(s){var a=e.outerHeight(),n=$('[data-js="sli_briefing_preview_container"]');if(i.removeClass("hidden"),t.removeClass("hidden"),TS.client.ui.checkInlineImgsAndIframes("unread"),s){n.css({height:0,"margin-top":(TS.environment.supports_sticky_position?-61:0)+"px"});var _=e.outerHeight();e.css({height:a,"padding-top":"81px","margin-top":"-61px"}),e.animate({height:_+61},300,function(){e.css({height:"auto","margin-top":"","padding-top":TS.environment.supports_sticky_position?"81px":""}),i.find(".sli_briefing__channel, .sli_briefing_view__footer").each(function(e,i){setTimeout(function(){$(i).css("opacity",1)},100*e+200)}),TS.model.prefs.seen_highlights_warm_welcome||(setTimeout(function(){TS.coachmark.start(TS.coachmarks.coachmarks.highlights_feedback,!0)},800),TS.model.prefs.seen_highlights_warm_welcome=!0,TS.prefs.setPrefByAPI({name:"seen_highlights_warm_welcome",value:!0}),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{seen_highlights_warm_welcome:"true"}})),TS.highlights_briefing.updated_sig.dispatch()})}else n.css({transition:"none",height:0,"margin-top":(TS.environment.supports_sticky_position?-61:0)+"px"}),t.css("transition","none"),i.find(".sli_briefing__channel, .sli_briefing_view__footer").css("opacity",1),e.css({height:"auto","margin-top":"","padding-top":TS.environment.supports_sticky_position?"81px":""});n.addClass("go-away"),t.addClass("expand"),s||setTimeout(function(){t.css("transition",""),n.css("transition","")},0)},R=function(){var s=$('[data-js="sli_briefing_preview_container"]');t.removeClass("expand").addClass("go-away");var a=e.outerHeight();i.css({opacity:0,"pointer-events":"none"}),v(null,0,!0);e.css({height:a,"margin-top":TS.environment.supports_sticky_position?"-61px":""}),e.animate({height:166},300,function(){TS.highlights_briefing.updated_sig.dispatch()}),s.css({transition:"none",transform:"translateY(118px)"}),setTimeout(function(){s.css({transition:"",transform:"translateY(0)",opacity:1,"pointer-events":""})},0)},P=function(){e.off("click"),t.off("click")},W=function(e,i){var s,t;if(TS.boot_data.feature_sli_highlights_cache){var n=TS.client.highlights.getHighlight(e,i);s=n.request_id,t=n.cached_request_id}else s=_.get(a,[e,i,"request_id"]),t=_.get(a,[e,i,"cached_request_id"]);r.scroll_top=TS.client.ui.unread.$scroller.scrollTop(),r.last_jump={ts:i,model_ob_id:e},r.show_briefing_back_button=!0,TS.boot_data.feature_sli_highlights_cache||TS.recaps_signal.markMessagesAsHighlights(_.toArray(a[e]),e),TS.client.ui.tryToJump(e,i);var d={channel_id:e,channel_type:e[0]||"",message_timestamp:i,request_id:s};t&&(d.cached_request_id=t),TS.clog.track("BRIEFING_JUMP_TO_CHANNEL",d)},L=function(e,i,s){0===C(i)?U(e.closest(".sli_briefing__channel"),s):(e.addClass(E("dismiss")),setTimeout(function(){e.css({transition:"margin-bottom 0.3s","margin-bottom":0}),e.animate({height:0},300,function(){var t=e.parents('.sli_briefing__channel[data-channel-id="'+i+'"]');e.remove(),J(i)&&(t.css({transition:"opacity 0.2s",opacity:.5}),t.find(".sli_briefing__channel_link .star").css("pointer-events","none")),s&&s()})},300))},U=function(e,i){e.addClass("dismiss"),setTimeout(function(){e.css({transition:"margin-bottom 0.3s","margin-bottom":0}),e.animate({height:0},300,function(){e.remove(),i&&i()}),w()||$(".sli_briefing_view__footer").css("opacity",0)},300)},J=function(e){return TS.boot_data.feature_sli_highlights_cache?_.every(a[e],function(i,s){var t=TS.client.highlights.getHighlight(e,s);return!t||"dismiss"===t.feedback}):_.every(a[e],function(i,s){return"dismiss"===n[e][s]})},Y=function(){return _.every(a,function(e,i){return _.every(a[i],function(e,s){var t=TS.client.highlights.getHighlight(i,s);return!t||("dismiss"===t.feedback||!0===t.left_feedback)})})},K=function(){e.replaceWith(TS.templates.sli_briefing()),t.addClass("hidden"),A(),v(null,0,!0),r.expanded=!1},V=function(e,i,s,t){x(i,s,t),O(i,s,t),L(e,t,function(){w()||K()})},z=function(e){TS.highlights_briefing.isEnabled()&&TS.model.unread_view_is_showing&&e&&a&&!_.isEmpty(a)&&a[e.id]&&_.each(a[e.id],function(i,s){s<e.last_read&&!i._removed&&TS.client.highlights.setDefaultFeedbackForHighlight(e.id,s,{feedback:"dismiss"},"briefing-mark-as-read")})},Q=function(e){TS.highlights_briefing.isEnabled()&&TS.model.unread_view_is_showing&&e&&a&&!_.isEmpty(a)&&a[e.id]&&_.each(a[e.id],function(i,s){var t=$('.sli_briefing__message[data-cache-id="'+e.id+"-"+s+'"]');if(t.length){var a=t.find("ts-message");a.hasClass("is_pinned")&&a.removeClass("is_pinned")}})},X=function(e,i,s){if(TS.highlights_briefing.isEnabled()&&a&&!_.isEmpty(a)&&a[e.id]&&a[e.id][i.ts]&&(_.includes(s,"text")||_.includes(s,"reply_count"))){var t=_.assign({},i,{channel_id:e.id});a[e.id][i.ts]=t;var n=$('.sli_briefing__message[data-cache-id="'+e.id+"-"+i.ts+'"]');if(n.length){n.find("ts-message").replaceWith(b(t))}}},Z=function(e,i){TS.highlights_briefing.isEnabled()&&TS.model.unread_view_is_showing&&a&&!_.isEmpty(a)&&a[e.id]&&a[e.id][i.ts]&&TS.client.highlights.setDefaultFeedbackForHighlight(e.id,i.ts,{feedback:"dismiss"})}}()}},[2747]);